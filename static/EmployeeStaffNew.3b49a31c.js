import{_ as N,a as T}from"./BaseFormSelect.cff2fed3.js";import{_ as V}from"./EmployeeAnswer.de36e2c2.js";import{_ as $,d as z,z as o,i as B,u as M,A as O,k as y,g as j,h as a,l as p,e as i,f as A,c as G,C as Q,E as R,G as H,F as J}from"./index.1259242b.js";import{u as K}from"./questions.2edc90ad.js";import{u as r}from"./answers.6f632858.js";import{u as P}from"./users.31980d07.js";import{u as W}from"./vee-validate.esm.bf701cf2.js";import{c as X,a as Y}from"./array.b736c012.js";import{d as Z}from"./data.6ab9a877.js";import{u as E}from"./account.95020594.js";import{u as ee}from"./system.8c767ab0.js";import"./BaseMessage.5f5c1b73.js";import"./BaseSelect.4d2ff7eb.js";import"./BaseFormTextarea.f60bdd17.js";import"./BaseTextarea.9f1fb73c.js";import"./BaseFormScore.e07164b3.js";import"./BaseScore.0b7d64cd.js";import"./BaseTag.67b906ed.js";import"./api.dfbafd1c.js";const se={class:"p-4"},te={class:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},oe=i("hr",{class:"border-1 border-theme my-4 w-full"},null,-1),ae={class:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},re=z({__name:"EmployeeStaffNew",setup(ne){var v;const I=o(()=>ee().systemStatus),l=o(()=>E().accountId),d=o(()=>K().questions(1)),{values:c,handleSubmit:C,setFieldValue:n}=W();n("department","\u672A\u586B\u540D\u55AE"),(v=d.value)==null||v.forEach((e,s)=>{n(`answers[${s}].qId`,e.id)});const F=[{text:"\u672A\u586B\u540D\u55AE",value:"\u672A\u586B\u540D\u55AE"}].concat(Z),x=o(()=>{var e;return(e=P().activeUsers)==null?void 0:e.filter(s=>s.department===c.department&&s.roles.includes(1)&&E().accountId!==s.id)}),D=o(()=>r().unfilledList[1]),S=o(()=>r().answerUsers(1)),f=o(()=>{n("reviewee",0);const e=c.department==="\u672A\u586B\u540D\u55AE"?D.value:x.value,s=e==null?void 0:e.filter(t=>{var u;return!((u=S.value)!=null&&u.includes(t.id))}).map(t=>({text:t.name,value:t.id}));return s!=null&&s.length&&n("reviewee",s[0].value),s}),_=B("setToastData",()=>null),w=B("setIsLoading",()=>null),b=C(async e=>{try{w(!0);const s=await r().createAnswers({reviewer:l.value,qId:1,reviewee:Number(e.reviewee),answers:e.answers});_({isActive:!0,variant:"success",message:"\u65B0\u589E\u6210\u529F"}),r().readAnswersInformation({userId:l.value,qId:1}),m.push("/employee/staff")}catch({response:s}){_({isActive:!0,variant:"error",message:"\u65B0\u589E\u5931\u6557"})}finally{w(!1)}}),m=M(),q=()=>m.push("/employee/staff"),U=async()=>{try{const e=await r().readUnfilledList({accountId:l.value,qId:1})}catch({response:e}){}};return O(async()=>{I.value!==1&&m.push("/employee/staff"),await U()}),(e,s)=>{const t=T,u=V,k=N;return p(),y(k,{size:"full",onConfirm:a(b),onCancel:q},{default:j(()=>{var g;return[i("article",se,[i("header",te,[A(t,{name:"department",options:a(F),class:"col-span-1",title:"\u7BE9\u9078",rule:X().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")},null,8,["options","rule"]),A(t,{name:"reviewee",options:a(f),class:"col-span-1",title:"\u5408\u4F5C\u5C0D\u8C61",disabled:!((g=a(f))!=null&&g.length),rule:Y().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")},null,8,["options","disabled","rule"])]),oe,i("article",ae,[(p(!0),G(J,null,Q(a(d),(h,L)=>R((p(),y(u,{id:h.id,key:h.id,index:L,"role-id":1,class:"col-span-1 lg:col-span-2 2xl:col-span-3"},null,8,["id","index"])),[[H,a(c).reviewee]])),128))])])]}),_:1},8,["onConfirm"])}}}),Fe=$(re,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/EmployeeStaffNew.vue"]]);export{Fe as default};
