import{_ as b}from"./TheModal.23fd6fef.js";import{_ as T}from"./EmployeeAnswer.8ea93956.js";import{_ as V}from"./BaseFormSelect.289b026c.js";import{_ as $,d as M,A as o,a as O,i as h,u as R,B as j,k as y,g as z,h as a,o as p,e as i,f as B,c as G,D as H,G as Q,H as J,F as K}from"./index.8e734258.js";import{u as P}from"./questions.1421bf41.js";import{u as n}from"./answers.2e22290b.js";import{u as W}from"./users.b6dbb148.js";import{u as X}from"./vee-validate.esm.ab02f1d5.js";import{c as Y,a as Z}from"./array.c60c04ee.js";import{d as ee}from"./data.ff9c2fa5.js";import{u as A}from"./account.ad01628e.js";import{u as se}from"./system.e1a63dec.js";import"./BaseFormTextarea.67540c63.js";import"./BaseMessage.65557bd2.js";import"./BaseTextarea.cf1c2079.js";import"./BaseFormScore.8a8972b9.js";import"./BaseScore.e7909276.js";import"./BaseTag.89a34d38.js";import"./BaseSelect.f6080912.js";import"./api.5131a906.js";const te={class:"p-4"},oe={class:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},re=i("hr",{class:"border-1 border-theme my-4 w-full"},null,-1),ae={class:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},ne=M({__name:"EmployeeStaffNew",setup(ue){var v;const E=o(()=>se().systemStatus),c=o(()=>A().accountId),d=o(()=>P().questions(1)),{values:l,handleSubmit:D,setFieldValue:r}=X();r("department","\u672A\u586B\u540D\u55AE"),(v=d.value)==null||v.forEach((e,s)=>{r(`answers[${s}].qId`,e.id)});const I=[{text:"\u672A\u586B\u540D\u55AE",value:"\u672A\u586B\u540D\u55AE"}].concat(ee),F=o(()=>{var e;return(e=W().activeUsers)==null?void 0:e.filter(s=>s.department===l.department&&s.roles.includes(1)&&A().accountId!==s.id)}),x=o(()=>n().unfilledList[1]),C=o(()=>n().isDoneAnswerUsers(1)),f=O(),q=o(()=>{r("reviewee",0);const e=l.department==="\u672A\u586B\u540D\u55AE"?x.value:F.value,s=e==null?void 0:e.filter(t=>{var u;return!((u=C.value)!=null&&u.includes(t.id))}).map(t=>({text:t.name,value:t.id}));return s!=null&&s.length&&r("reviewee",s[0].value),f.query.reviewee&&r("reviewee",f.query.reviewee),s}),_=h("setToastData",()=>null),w=h("setIsLoading",()=>null),S=D(async e=>{try{w(!0);const s=await n().createAnswers({reviewer:c.value,qId:1,reviewee:Number(e.reviewee),answers:e.answers});_({isActive:!0,variant:"success",message:"\u65B0\u589E\u6210\u529F"}),n().readAnswersInformation({userId:c.value,qId:1}),m.push("/employee/staff")}catch({response:s}){_({isActive:!0,variant:"error",message:"\u65B0\u589E\u5931\u6557"})}finally{w(!1)}}),m=R(),U=()=>m.push("/employee/staff"),k=async()=>{try{const e=await n().readUnfilledList({accountId:c.value,qId:1})}catch({response:e}){}};return j(async()=>{E.value!==1&&m.push("/employee/staff"),await k()}),(e,s)=>{const t=V,u=T,L=b;return p(),y(L,{size:"full",onConfirm:a(S),onCancel:U},{default:z(()=>[i("article",te,[i("header",oe,[B(t,{name:"department",options:a(I),class:"col-span-1",title:"\u7BE9\u9078",rule:Y().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")},null,8,["options","rule"]),B(t,{name:"reviewee",options:a(q),class:"col-span-1",title:"\u5408\u4F5C\u5C0D\u8C61",rule:Z().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")},null,8,["options","rule"])]),re,i("article",ae,[(p(!0),G(K,null,H(a(d),(g,N)=>Q((p(),y(u,{id:g.id,key:g.id,index:N,"role-id":1,class:"col-span-1 lg:col-span-2 2xl:col-span-3"},null,8,["id","index"])),[[J,a(l).reviewee]])),128))])])]),_:1},8,["onConfirm"])}}}),Ce=$(ne,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/EmployeeStaffNew.vue"]]);export{Ce as default};
