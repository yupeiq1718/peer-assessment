import{_ as b,a as U}from"./BaseFormSelect.d260a6ba.js";import{_ as $}from"./EmployeeAnswer.4b489961.js";import{_ as S,d as T,z as o,i as f,u as V,k as w,g as z,h as r,l as a,e as j,f as v,c as M,C as O,F as Q}from"./index.a07c9b9e.js";import{u as R}from"./questions.d5088a89.js";import{u as n}from"./answers.71f0ba27.js";import{u as G}from"./users.03d9ab6c.js";import{u as H}from"./vee-validate.esm.a36f4fe9.js";import{c as g,a as B,b as u,d as J}from"./array.2d7814ad.js";import{d as K}from"./data.5612e520.js";import{u as C}from"./account.eadd3a32.js";import"./BaseMessage.c3e469c8.js";import"./BaseSelect.f7b0837f.js";import"./BaseFormTextarea.0c248811.js";import"./BaseTextarea.05a2c1e5.js";import"./BaseFormScore.00defae8.js";import"./BaseScore.b587a6ab.js";import"./BaseTag.a95911c1.js";import"./api.9ad47dd7.js";const P={class:"mx-5 mt-5 mb-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},W=T({__name:"EmployeeLeaderNew",setup(X){var d;const i=o(()=>C().accountId),c=o(()=>R().questions(2)),F=g().shape({department:B().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),reviewee:u().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),answers:J().of(g({qId:u().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),score:u(),comment:B()}))}),h={department:"",reviewee:0,answers:((d=c.value)==null?void 0:d.map(e=>({qId:e.id,score:0,comment:""})))||[]},{values:I,handleSubmit:y}=H({initialValues:h,validationSchema:F}),x=o(()=>{var e;return(e=G().activeUsers)==null?void 0:e.filter(s=>s.department===I.department&&s.role.includes(2)&&C().accountId!==s.id)}),q=o(()=>n().answerUsers(2)),E=o(()=>{var e;return(e=x.value)==null?void 0:e.filter(s=>{var t;return!((t=q.value)!=null&&t.includes(s.id))}).map(s=>({text:s.name,value:s.id}))}),m=f("setToastData",()=>null),l=f("setIsLoading",()=>null),A=y(async e=>{try{l(!0);const s=await n().createAnswers({reviewer:i.value,qId:2,reviewee:Number(e.reviewee),answers:e.answers});m({isActive:!0,variant:"success",message:"\u65B0\u589E\u6210\u529F"}),n().readAnswersInformation({userId:i.value,qId:2}),p.push("/employee/leader")}catch({response:s}){m({isActive:!0,variant:"error",message:"\u65B0\u589E\u5931\u6557"})}finally{l(!1)}}),p=V(),k=()=>p.push("/employee/leader");return(e,s)=>{const t=U,D=$,L=b;return a(),w(L,{size:"full",onConfirm:r(A),onCancel:k},{default:z(()=>[j("article",P,[v(t,{name:"department",options:r(K),class:"col-span-1",title:"\u5408\u4F5C\u90E8\u9580"},null,8,["options"]),v(t,{name:"reviewee",options:r(E),class:"col-span-1",title:"\u5408\u4F5C\u5C0D\u8C61"},null,8,["options"]),(a(!0),M(Q,null,O(r(c),(_,N)=>(a(),w(D,{id:_.id,key:_.id,index:N,"role-id":2,class:"col-span-1 lg:col-span-2 2xl:col-span-3"},null,8,["id","index"]))),128))])]),_:1},8,["onConfirm"])}}}),we=S(W,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/EmployeeLeaderNew.vue"]]);export{we as default};
