import{_ as L,a as T}from"./BaseFormSelect.9cc81594.js";import{_ as V}from"./EmployeeAnswer.9a67fdd1.js";import{_ as z,d as R,z as t,a as U,i as g,u as j,k as B,g as M,h as o,l as r,e as O,f as F,c as Q,C as G,F as H}from"./index.ca97bf03.js";import{u as J}from"./questions.41db5345.js";import{u as n}from"./answers.06deac7a.js";import{u as K}from"./users.0ccac95b.js";import{u as P}from"./vee-validate.esm.dcee6140.js";import{c as C,a as I,b as i,d as W}from"./array.55294be0.js";import{d as X}from"./data.d5f5edba.js";import{u as Y}from"./account.f4baf2e6.js";import"./BaseMessage.3ca80a76.js";import"./BaseSelect.46d8b028.js";import"./BaseFormTextarea.4b341efc.js";import"./BaseTextarea.1e6fa2b9.js";import"./BaseFormScore.f57289c1.js";import"./BaseScore.104f0ff3.js";import"./BaseTag.40556f5c.js";import"./api.41d29b3e.js";const Z={class:"mx-5 mt-5 mb-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},ee=R({__name:"EmployeeStaffEdit",setup(se){var d,f,_;const u=t(()=>Y().accountId),c=U(),h=t(()=>J().questions(1)),a=t(()=>n().answerInformation({qId:1,id:Number(c.params.id)})),y=C({department:I().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),reviewee:i().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),answers:W().of(C({qId:i(),score:i(),comment:I()}))}),b={department:(d=a.value)==null?void 0:d.reviewee.department,reviewee:(f=a.value)==null?void 0:f.reviewee.id,answers:((_=a.value)==null?void 0:_.answers)||[]},{values:x,handleSubmit:E}=P({initialValues:b,validationSchema:y}),q=t(()=>{var e;return(e=K().activeUsers)==null?void 0:e.filter(s=>s.department===x.department&&s.roles.includes(1))}),A=t(()=>{var e;return(e=q.value)==null?void 0:e.map(s=>({text:s.name,value:s.id}))}),m=g("setToastData",()=>null),l=g("setIsLoading",()=>null),k=E(async e=>{try{l(!0);const s=await n().updateAnswers({id:Number(c.params.id),reviewer:u.value,qId:1,reviewee:Number(e.reviewee),answers:e.answers});m({isActive:!0,variant:"success",message:"\u66F4\u65B0\u6210\u529F"}),n().readAnswersInformation({userId:u.value,qId:1}),p.push("/employee/staff")}catch({response:s}){m({isActive:!0,variant:"error",message:"\u66F4\u65B0\u5931\u6557"})}finally{l(!1)}}),p=j(),S=()=>p.push("/employee/staff");return(e,s)=>{const v=T,D=V,N=L;return r(),B(N,{size:"full",onConfirm:o(k),onCancel:S},{default:M(()=>[O("article",Z,[F(v,{name:"department",options:o(X),class:"col-span-1",title:"\u5408\u4F5C\u90E8\u9580",disabled:""},null,8,["options"]),F(v,{name:"reviewee",options:o(A),class:"col-span-1",title:"\u5408\u4F5C\u5C0D\u8C61",disabled:""},null,8,["options"]),(r(!0),Q(H,null,G(o(h),(w,$)=>(r(),B(D,{id:w.id,key:w.id,index:$,"role-id":1,class:"col-span-1 lg:col-span-2 2xl:col-span-3"},null,8,["id","index"]))),128))])]),_:1},8,["onConfirm"])}}}),Fe=z(ee,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/EmployeeStaffEdit.vue"]]);export{Fe as default};
