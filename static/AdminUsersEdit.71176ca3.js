import{_ as w,a as y}from"./BaseFormSelect.9047501e.js";import{_ as N}from"./BaseFormTag.21f1e5d0.js";import{_ as k}from"./BaseFormInput.889477ba.js";import{_ as T,d as q,a as S,z as u,i as F,u as V,k as $,g as z,h as n,l as L,e as R,f as t}from"./index.bd2cfc47.js";import{u as o}from"./users.d328b503.js";import{d as j,r as M}from"./data.5612e520.js";import{u as O}from"./vee-validate.esm.9b475a1d.js";import{c as G,a as v,d as H}from"./array.638ad13b.js";import"./BaseMessage.a3d245c2.js";import"./BaseSelect.aefaf5b3.js";import"./BaseTag.26f8522f.js";import"./BaseInput.84b7bb44.js";import"./api.074081fa.js";const J={class:"m-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},K=q({__name:"AdminUsersEdit",setup(P){var c,p,d,_,g;const h=S(),r=u(()=>h.params.id),a=u(()=>o().user(Number(r.value))),C=G({department:v().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),name:v().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),role:H().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").min(1,"\u6700\u5C11\u9078\u64C7\u4E00\u9805")}),{handleSubmit:x}=O({initialValues:{department:((c=a.value)==null?void 0:c.department)||"",email:((p=a.value)==null?void 0:p.email)||"",name:((d=a.value)==null?void 0:d.name)||"",role:((_=a.value)==null?void 0:_.role)||[],managerId:(g=a.value)==null?void 0:g.manager.id},validationSchema:C}),D=u(()=>{var e;return(e=o().activeUsers)==null?void 0:e.filter(s=>s.role.includes(2)&&s.id!==Number(r.value)).map(s=>({text:s.name,value:s.id}))}),m=F("setToastData",()=>null),i=F("setIsLoading",()=>null),E=x(async e=>{try{i(!0);const s=await o().updateUser({id:Number(r.value),user:{name:e.name,department:e.department,role:e.role,managerId:e.managerId}});m({isActive:!0,variant:"success",message:"\u66F4\u65B0\u6210\u529F"}),await o().readUsers(),l.push("/admin/users")}catch({response:s}){m({isActive:!0,variant:"error",message:"\u66F4\u65B0\u5931\u6557"})}finally{i(!1)}}),l=V(),I=()=>l.push("/admin/users");return(e,s)=>{const f=k,B=y,U=N,b=w;return L(),$(b,{size:"full",onConfirm:n(E),onCancel:I},{default:z(()=>[R("article",J,[t(f,{name:"name",type:"text",class:"col-span-1",title:"\u59D3\u540D"}),t(f,{name:"email",class:"col-span-1",type:"email",title:"\u96FB\u5B50\u90F5\u4EF6",disabled:""}),t(B,{name:"department",options:n(j),class:"col-span-1",title:"\u90E8\u9580"},null,8,["options"]),t(B,{name:"managerId",options:n(D),class:"col-span-1",title:"\u4E3B\u7BA1"},null,8,["options"]),t(U,{name:"role",class:"col-span-1",title:"\u89D2\u8272",tags:n(M).map(A=>A.text)},null,8,["tags"])])]),_:1},8,["onConfirm"])}}}),me=T(K,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/AdminUsersEdit.vue"]]);export{me as default};
