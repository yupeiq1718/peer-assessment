import{_ as N,a as S}from"./BaseFormSelect.5ca0478e.js";import{_ as T}from"./EmployeeAnswer.0ec6dc2b.js";import{_ as V,d as $,z as o,i as B,u as z,A as M,k as A,g as O,h as r,l as m,e as i,f as y,c as j,C as G,E as Q,G as R,F as H}from"./index.c6c19617.js";import{u as J}from"./questions.57021e7f.js";import{u as n}from"./answers.1a61d295.js";import{u as K}from"./users.9cbb6080.js";import{u as P}from"./vee-validate.esm.b910bb18.js";import{c as W,a as X}from"./array.1e492866.js";import{d as Y}from"./data.6ab9a877.js";import{u as E}from"./account.3b00c131.js";import"./BaseMessage.f4c5d55e.js";import"./BaseSelect.991e8e38.js";import"./BaseFormTextarea.8b16f0ef.js";import"./BaseTextarea.307185c8.js";import"./BaseFormScore.857b94ae.js";import"./BaseScore.bd51e175.js";import"./BaseTag.0bd065e9.js";import"./api.51a74389.js";const Z={class:"p-4"},ee={class:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},se=i("hr",{class:"border-1 border-theme my-4 w-full"},null,-1),te={class:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},oe=$({__name:"EmployeeStaffNew",setup(re){var v;const l=o(()=>E().accountId),d=o(()=>J().questions(1)),{values:c,handleSubmit:I,setFieldValue:a}=P();a("department","\u672A\u586B\u540D\u55AE"),(v=d.value)==null||v.forEach((e,s)=>{a(`answers[${s}].qId`,e.id)});const C=[{text:"\u672A\u586B\u540D\u55AE",value:"\u672A\u586B\u540D\u55AE"}].concat(Y),F=o(()=>{var e;return(e=K().activeUsers)==null?void 0:e.filter(s=>s.department===c.department&&s.roles.includes(1)&&E().accountId!==s.id)}),x=o(()=>n().unfilledList[1]),D=o(()=>n().answerUsers(1)),p=o(()=>{a("reviewee",0);const e=c.department==="\u672A\u586B\u540D\u55AE"?x.value:F.value,s=e==null?void 0:e.filter(t=>{var u;return!((u=D.value)!=null&&u.includes(t.id))}).map(t=>({text:t.name,value:t.id}));return s!=null&&s.length&&a("reviewee",s[0].value),s}),f=B("setToastData",()=>null),_=B("setIsLoading",()=>null),b=I(async e=>{try{_(!0);const s=await n().createAnswers({reviewer:l.value,qId:1,reviewee:Number(e.reviewee),answers:e.answers});f({isActive:!0,variant:"success",message:"\u65B0\u589E\u6210\u529F"}),n().readAnswersInformation({userId:l.value,qId:1}),w.push("/employee/staff")}catch({response:s}){f({isActive:!0,variant:"error",message:"\u65B0\u589E\u5931\u6557"})}finally{_(!1)}}),w=z(),q=()=>w.push("/employee/staff"),U=async()=>{try{const e=await n().readUnfilledList({accountId:l.value,qId:1})}catch({response:e}){}};return M(async()=>{await U()}),(e,s)=>{const t=S,u=T,k=N;return m(),A(k,{size:"full",onConfirm:r(b),onCancel:q},{default:O(()=>{var g;return[i("article",Z,[i("header",ee,[y(t,{name:"department",options:r(C),class:"col-span-1",title:"\u7BE9\u9078",rule:W().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")},null,8,["options","rule"]),y(t,{name:"reviewee",options:r(p),class:"col-span-1",title:"\u5408\u4F5C\u5C0D\u8C61",disabled:!((g=r(p))!=null&&g.length),rule:X().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")},null,8,["options","disabled","rule"])]),se,i("article",te,[(m(!0),j(H,null,G(r(d),(h,L)=>Q((m(),A(u,{id:h.id,key:h.id,index:L,"role-id":1,class:"col-span-1 lg:col-span-2 2xl:col-span-3"},null,8,["id","index"])),[[R,r(c).reviewee]])),128))])])]}),_:1},8,["onConfirm"])}}}),Ee=V(oe,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/EmployeeStaffNew.vue"]]);export{Ee as default};
