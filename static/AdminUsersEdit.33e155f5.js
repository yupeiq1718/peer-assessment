import{_ as N,a as k}from"./BaseFormSelect.f331853c.js";import{_ as q}from"./BaseFormTag.d0f1466c.js";import{_ as T}from"./BaseFormInput.b8b5bcc5.js";import{_ as $,d as S,a as V,A as u,i as h,u as L,k as R,g as j,h as o,o as z,e as M,f as n}from"./index.8a7eebd7.js";import{u as r}from"./users.9f95d837.js";import{d as O,r as G}from"./data.ff9c2fa5.js";import{u as H}from"./vee-validate.esm.31a7a497.js";import{b as J,c as C,d as K,a as P}from"./array.b769473e.js";import"./BaseMessage.b0f3323e.js";import"./BaseSelect.a64e9a4c.js";import"./BaseTag.c23d0e6e.js";import"./BaseInput.db43e897.js";import"./api.ff4995b0.js";const Q={class:"m-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},W=S({__name:"AdminUsersEdit",setup(X){var p,d,_,g,B,f;const D=V(),m=u(()=>D.params.id),a=u(()=>r().user(Number(m.value))),x=J({department:C().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),name:C().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),roles:K().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").min(1,"\u6700\u5C11\u9078\u64C7\u4E00\u9805"),managerId:P().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")}),{setFieldValue:t,handleSubmit:I}=H({validationSchema:x});t("department",(p=a.value)==null?void 0:p.department),t("email",(d=a.value)==null?void 0:d.email),t("name",(_=a.value)==null?void 0:_.name),t("roles",(g=a.value)==null?void 0:g.roles),t("managerId",(f=(B=a.value)==null?void 0:B.manager)==null?void 0:f.id);const b=u(()=>{var e;return(e=r().activeUsers)==null?void 0:e.filter(s=>s.roles.includes(2)).map(s=>({text:s.name,value:s.id}))}),i=h("setToastData",()=>null),c=h("setIsLoading",()=>null),A=I(async e=>{try{c(!0);const s=await r().updateUser({id:Number(m.value),user:{name:e.name,department:e.department,roles:e.roles,managerId:Number(e.managerId)}});i({isActive:!0,variant:"success",message:"\u66F4\u65B0\u6210\u529F"}),await r().readUsers(),l.push("/admin/users")}catch({response:s}){i({isActive:!0,variant:"error",message:"\u66F4\u65B0\u5931\u6557"})}finally{c(!1)}}),l=L(),E=()=>l.push("/admin/users");return(e,s)=>{const F=T,v=k,U=q,w=N;return z(),R(w,{size:"full",onConfirm:o(A),onCancel:E},{default:j(()=>[M("article",Q,[n(F,{name:"name",type:"text",class:"col-span-1",title:"\u59D3\u540D"}),n(F,{name:"email",class:"col-span-1",type:"email",title:"\u96FB\u5B50\u90F5\u4EF6",disabled:""}),n(v,{name:"department",options:o(O),class:"col-span-1",title:"\u90E8\u9580"},null,8,["options"]),n(v,{name:"managerId",options:o(b),class:"col-span-1",title:"\u4E3B\u7BA1"},null,8,["options"]),n(U,{name:"roles",class:"col-span-1",title:"\u89D2\u8272",tags:o(G).map(y=>y.text)},null,8,["tags"])])]),_:1},8,["onConfirm"])}}}),le=$(W,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/AdminUsersEdit.vue"]]);export{le as default};
