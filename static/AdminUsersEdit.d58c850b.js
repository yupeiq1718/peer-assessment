import{_ as A,a as q}from"./BaseFormSelect.aa63f696.js";import{_ as N}from"./BaseFormTag.ebf52899.js";import{_ as S}from"./BaseFormInput.15740f10.js";import{_ as T,d as $,S as k,m as u,i as h,x as V,f as L,w as R,u as o,o as j,a as z,b as t}from"./index.09a6d77f.js";import{u as r}from"./users.11ee2723.js";import{d as M,r as O}from"./data.054ee288.js";import{u as G}from"./vee-validate.esm.92c01090.js";import{c as H,a as m,d as J,b as K}from"./array.8d8f64ff.js";import"./BaseMessage.354e107b.js";import"./BaseSelect.d7f6cce8.js";import"./BaseTag.126a2c10.js";import"./BaseInput.926e03c0.js";import"./api.547c5d0a.js";const P={class:"m-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},Q=$({__name:"AdminUsersEdit",setup(W){var p,d,_,B,g;const v=k(),i=u(()=>v.params.id),a=u(()=>r().user(Number(i.value))),C=H({department:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),name:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),email:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").email("\u4E0D\u7B26\u5408\u96FB\u5B50\u90F5\u4EF6\u683C\u5F0F"),role:J().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").min(1,"\u6700\u5C11\u9078\u64C7\u4E00\u9805"),managerId:K()}),{handleSubmit:D}=G({initialValues:{department:((p=a.value)==null?void 0:p.department)||"",email:((d=a.value)==null?void 0:d.email)||"",name:((_=a.value)==null?void 0:_.name)||"",role:((B=a.value)==null?void 0:B.role)||[],managerId:((g=a.value)==null?void 0:g.managerId)||0},validationSchema:C}),x=u(()=>{var e;return(e=r().users)==null?void 0:e.filter(s=>s.role.includes(2)).map(s=>({text:s.name,value:s.id}))}),c=h("setToastData",()=>null),n=h("setIsLoading",()=>null),E=async()=>{try{n(!0);const e=await r().readUsers()}catch{}finally{n(!1)}},I=D(async e=>{try{n(!0);const s=await r().updateUser({id:Number(i.value),user:{name:e.name,department:e.department,role:e.role,managerId:e.managerId}});c({isActive:!0,variant:"success",message:"\u66F4\u65B0\u6210\u529F"}),l.push("/admin/users"),E()}catch({response:s}){c({isActive:!0,variant:"error",message:"\u66F4\u65B0\u5931\u6557"})}finally{n(!1)}}),l=V(),y=()=>l.push("/admin/users");return(e,s)=>{const f=S,F=q,b=N,U=A;return j(),L(U,{size:"full",onConfirm:o(I),onCancel:y},{default:R(()=>[z("article",P,[t(f,{name:"name",type:"text",class:"col-span-1",title:"\u59D3\u540D"}),t(f,{name:"email",class:"col-span-1",type:"email",title:"\u96FB\u5B50\u90F5\u4EF6",disabled:""}),t(F,{name:"department",options:o(M),class:"col-span-1",title:"\u90E8\u9580"},null,8,["options"]),t(F,{name:"managerId",options:o(x),class:"col-span-1",title:"\u4E3B\u7BA1"},null,8,["options"]),t(b,{name:"role",class:"col-span-1",title:"\u89D2\u8272",tags:o(O).map(w=>w.text)},null,8,["tags"])])]),_:1},8,["onConfirm"])}}}),ce=T(Q,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/AdminUsersEdit.vue"]]);export{ce as default};
