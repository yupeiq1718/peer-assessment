import{_ as N,a as b}from"./BaseFormSelect.f331853c.js";import{_ as T}from"./EmployeeAnswer.54c5963b.js";import{_ as V,d as $,A as o,i as g,u as M,B as O,k as h,g as j,h as r,o as p,e as i,f as B,c as z,D as G,G as H,H as Q,F as R}from"./index.8a7eebd7.js";import{u as J}from"./questions.82fa4c4d.js";import{u as a}from"./answers.8b7baee0.js";import{u as K}from"./users.9f95d837.js";import{u as P}from"./vee-validate.esm.31a7a497.js";import{c as W,a as X}from"./array.b769473e.js";import{d as Y}from"./data.ff9c2fa5.js";import{u as y}from"./account.93e5655a.js";import{u as Z}from"./system.301dd653.js";import"./BaseMessage.b0f3323e.js";import"./BaseSelect.a64e9a4c.js";import"./BaseFormTextarea.e3c5dff2.js";import"./BaseTextarea.7a47815a.js";import"./BaseFormScore.9b74912f.js";import"./BaseScore.532e7dba.js";import"./BaseTag.c23d0e6e.js";import"./api.ff4995b0.js";const ee={class:"p-4"},se={class:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},te=i("hr",{class:"border-1 border-theme my-4 w-full"},null,-1),oe={class:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},re=$({__name:"EmployeeStaffNew",setup(ae){var w;const A=o(()=>Z().systemStatus),c=o(()=>y().accountId),d=o(()=>J().questions(1)),{values:l,handleSubmit:E,setFieldValue:n}=P();n("department","\u672A\u586B\u540D\u55AE"),(w=d.value)==null||w.forEach((e,s)=>{n(`answers[${s}].qId`,e.id)});const D=[{text:"\u672A\u586B\u540D\u55AE",value:"\u672A\u586B\u540D\u55AE"}].concat(Y),I=o(()=>{var e;return(e=K().activeUsers)==null?void 0:e.filter(s=>s.department===l.department&&s.roles.includes(1)&&y().accountId!==s.id)}),F=o(()=>a().unfilledList[1]),x=o(()=>a().isDoneAnswerUsers(1)),C=o(()=>{n("reviewee",0);const e=l.department==="\u672A\u586B\u540D\u55AE"?F.value:I.value,s=e==null?void 0:e.filter(t=>{var u;return!((u=x.value)!=null&&u.includes(t.id))}).map(t=>({text:t.name,value:t.id}));return s!=null&&s.length&&n("reviewee",s[0].value),s}),f=g("setToastData",()=>null),_=g("setIsLoading",()=>null),S=E(async e=>{try{_(!0);const s=await a().createAnswers({reviewer:c.value,qId:1,reviewee:Number(e.reviewee),answers:e.answers});f({isActive:!0,variant:"success",message:"\u65B0\u589E\u6210\u529F"}),a().readAnswersInformation({userId:c.value,qId:1}),m.push("/employee/staff")}catch({response:s}){f({isActive:!0,variant:"error",message:"\u65B0\u589E\u5931\u6557"})}finally{_(!1)}}),m=M(),q=()=>m.push("/employee/staff"),U=async()=>{try{const e=await a().readUnfilledList({accountId:c.value,qId:1})}catch({response:e}){}};return O(async()=>{A.value!==1&&m.push("/employee/staff"),await U()}),(e,s)=>{const t=b,u=T,k=N;return p(),h(k,{size:"full",onConfirm:r(S),onCancel:q},{default:j(()=>[i("article",ee,[i("header",se,[B(t,{name:"department",options:r(D),class:"col-span-1",title:"\u7BE9\u9078",rule:W().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")},null,8,["options","rule"]),B(t,{name:"reviewee",options:r(C),class:"col-span-1",title:"\u5408\u4F5C\u5C0D\u8C61",rule:X().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")},null,8,["options","rule"])]),te,i("article",oe,[(p(!0),z(R,null,G(r(d),(v,L)=>H((p(),h(u,{id:v.id,key:v.id,index:L,"role-id":1,class:"col-span-1 lg:col-span-2 2xl:col-span-3"},null,8,["id","index"])),[[Q,r(l).reviewee]])),128))])])]),_:1},8,["onConfirm"])}}}),Ie=V(re,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/EmployeeStaffNew.vue"]]);export{Ie as default};
