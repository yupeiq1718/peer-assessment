import{_ as S,a as $}from"./BaseFormSelect.600aef34.js";import{_ as T}from"./EmployeeAnswer.956f0871.js";import{_ as V,d as R,S as j,m as t,i as v,x as z,f as g,w as M,u as o,o as a,a as O,b as B,c as Q,v as U,F as G}from"./index.afca9dea.js";import{u as H}from"./questions.b0717569.js";import{u as n}from"./answers.402596ce.js";import{u as J}from"./users.5cc855d4.js";import{u as K}from"./vee-validate.esm.eb2f773f.js";import{c as C,a as E,b as i,d as P}from"./array.d7216b27.js";import{d as W}from"./data.054ee288.js";import"./BaseMessage.2ae6a500.js";import"./BaseSelect.55c818e4.js";import"./BaseFormTextarea.62e28260.js";import"./BaseTextarea.c55cd366.js";import"./BaseFormScore.f069f18e.js";import"./BaseScore.678b9138.js";import"./BaseTag.abb97a7f.js";import"./api.b6312681.js";const X={class:"mx-5 mt-5 mb-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},Y=R({__name:"EmployeeLeaderEdit",setup(Z){var p,d,_;const u=j(),F=t(()=>H().questions(2)),r=t(()=>n().answerInformation({qId:2,id:Number(u.params.id)})),b=C({department:E().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),reviewee:i().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),answers:P().of(C({qId:i(),score:i(),comment:E()}))}),h={department:(p=r.value)==null?void 0:p.reviewee.department,reviewee:(d=r.value)==null?void 0:d.reviewee.id,answers:((_=r.value)==null?void 0:_.answers)||[]},{values:x,handleSubmit:y}=K({initialValues:h,validationSchema:b}),I=t(()=>{var e;return(e=J().users)==null?void 0:e.filter(s=>s.department===x.department&&s.role.includes(2))}),q=t(()=>{var e;return(e=I.value)==null?void 0:e.map(s=>({text:s.name,value:s.id}))}),m=v("setToastData",()=>null),c=v("setIsLoading",()=>null),A=y(async e=>{try{c(!0);const s=await n().updateAnswers({id:Number(u.params.id),reviewer:1,qId:2,reviewee:Number(e.reviewee),answers:e.answers});m({isActive:!0,variant:"success",message:"\u65B0\u589E\u6210\u529F"}),n().readAnswersInformation({userId:1,qId:2}),l.push("/employee/leader")}catch({response:s}){m({isActive:!0,variant:"error",message:"\u65B0\u589E\u5931\u6557"})}finally{c(!1)}}),l=z(),L=()=>l.push("/employee/leader");return(e,s)=>{const f=$,k=T,D=S;return a(),g(D,{size:"full",onConfirm:o(A),onCancel:L},{default:M(()=>[O("article",X,[B(f,{name:"department",options:o(W),class:"col-span-1",title:"\u5408\u4F5C\u90E8\u9580",disabled:""},null,8,["options"]),B(f,{name:"reviewee",options:o(q),class:"col-span-1",title:"\u5408\u4F5C\u5C0D\u8C61",disabled:""},null,8,["options"]),(a(!0),Q(G,null,U(o(F),(w,N)=>(a(),g(k,{id:w.id,key:w.id,index:N,"role-id":2,class:"col-span-1 lg:col-span-2 2xl:col-span-3"},null,8,["id","index"]))),128))])]),_:1},8,["onConfirm"])}}}),ve=V(Y,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/EmployeeLeaderEdit.vue"]]);export{ve as default};
