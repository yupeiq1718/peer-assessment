import{_ as N}from"./TheModal.23fd6fef.js";import{_ as k}from"./BaseFormTag.8cda039b.js";import{_ as T}from"./BaseFormSelect.289b026c.js";import{_ as $}from"./BaseFormInput.9cdf12d4.js";import{_ as v,d as S,a as V,A as u,i as D,u as L,k as R,g as j,h as o,o as z,e as M,f as n}from"./index.8e734258.js";import{u as r}from"./users.b6dbb148.js";import{d as O,r as G}from"./data.ff9c2fa5.js";import{u as H}from"./vee-validate.esm.ab02f1d5.js";import{b as J,c as m,d as K,a as P}from"./array.c60c04ee.js";import"./BaseMessage.65557bd2.js";import"./BaseTag.89a34d38.js";import"./BaseSelect.f6080912.js";import"./BaseInput.d313ad68.js";import"./api.5131a906.js";const Q={class:"m-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},W=S({__name:"AdminUsersEdit",setup(X){var d,_,B,F,g,f;const E=V(),i=u(()=>E.params.id),t=u(()=>r().user(Number(i.value))),x=J({department:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),name:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),email:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").test("email","\u4E0D\u7B26\u5408\u516C\u53F8\u96FB\u5B50\u90F5\u4EF6\u683C\u5F0F",e=>(e==null?void 0:e.includes("@osensetech.com"))&&(e==null?void 0:e.split("@osensetech.com")[1])===""||!1),roles:K().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").min(1,"\u6700\u5C11\u9078\u64C7\u4E00\u9805"),managerId:P().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")}),{setFieldValue:a,handleSubmit:I}=H({validationSchema:x});a("department",(d=t.value)==null?void 0:d.department),a("email",(_=t.value)==null?void 0:_.email),a("name",(B=t.value)==null?void 0:B.name),a("roles",(F=t.value)==null?void 0:F.roles),a("managerId",(f=(g=t.value)==null?void 0:g.manager)==null?void 0:f.id);const A=u(()=>{var e;return(e=r().activeUsers)==null?void 0:e.filter(s=>s.roles.includes(2)).map(s=>({text:s.name,value:s.id}))}),c=D("setToastData",()=>null),l=D("setIsLoading",()=>null),U=I(async e=>{try{l(!0);const s=await r().updateUser({id:Number(i.value),user:{name:e.name,email:e.email,department:e.department,roles:e.roles,managerId:Number(e.managerId)}});c({isActive:!0,variant:"success",message:"\u66F4\u65B0\u6210\u529F"}),await r().readUsers(),p.push("/admin/users")}catch({response:s}){c({isActive:!0,variant:"error",message:"\u66F4\u65B0\u5931\u6557"})}finally{l(!1)}}),p=L(),b=()=>p.push("/admin/users");return(e,s)=>{const h=$,C=T,q=k,w=N;return z(),R(w,{size:"full",onConfirm:o(U),onCancel:b},{default:j(()=>[M("article",Q,[n(h,{name:"name",type:"text",class:"col-span-1",title:"\u59D3\u540D"}),n(h,{name:"email",class:"col-span-1",type:"email",title:"\u96FB\u5B50\u90F5\u4EF6"}),n(C,{name:"department",options:o(O),class:"col-span-1",title:"\u90E8\u9580"},null,8,["options"]),n(C,{name:"managerId",options:o(A),class:"col-span-1",title:"\u4E3B\u7BA1"},null,8,["options"]),n(q,{name:"roles",class:"col-span-1",title:"\u89D2\u8272",tags:o(G).map(y=>y.text)},null,8,["tags"])])]),_:1},8,["onConfirm"])}}}),pe=v(W,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/AdminUsersEdit.vue"]]);export{pe as default};
