import{_ as N}from"./TheModal.548419cb.js";import{_ as k}from"./BaseFormTag.9a9ab609.js";import{_ as q}from"./BaseFormSelect.b79dfde1.js";import{_ as T}from"./BaseFormInput.fc272df9.js";import{_ as $,d as S,a as V,A as u,i as h,u as L,k as R,g as j,h as o,o as z,e as M,f as n}from"./index.0be65a8a.js";import{u as r}from"./users.3212cb6b.js";import{d as O,r as G}from"./data.ff9c2fa5.js";import{u as H}from"./vee-validate.esm.4a49d756.js";import{b as J,c as C,d as K,a as P}from"./array.5863a7c5.js";import"./BaseMessage.ef8b2797.js";import"./BaseTag.5d7ca0bb.js";import"./BaseSelect.6ecb9d22.js";import"./BaseInput.1b761b3c.js";import"./api.c2bc4a84.js";const Q={class:"m-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},W=S({__name:"AdminUsersEdit",setup(X){var p,d,_,g,B,f;const D=V(),m=u(()=>D.params.id),a=u(()=>r().user(Number(m.value))),x=J({department:C().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),name:C().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),roles:K().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").min(1,"\u6700\u5C11\u9078\u64C7\u4E00\u9805"),managerId:P().required("\u6B64\u6B04\u4F4D\u5FC5\u586B")}),{setFieldValue:t,handleSubmit:I}=H({validationSchema:x});t("department",(p=a.value)==null?void 0:p.department),t("email",(d=a.value)==null?void 0:d.email),t("name",(_=a.value)==null?void 0:_.name),t("roles",(g=a.value)==null?void 0:g.roles),t("managerId",(f=(B=a.value)==null?void 0:B.manager)==null?void 0:f.id);const b=u(()=>{var e;return(e=r().activeUsers)==null?void 0:e.filter(s=>s.roles.includes(2)).map(s=>({text:s.name,value:s.id}))}),i=h("setToastData",()=>null),c=h("setIsLoading",()=>null),A=I(async e=>{try{c(!0);const s=await r().updateUser({id:Number(m.value),user:{name:e.name,department:e.department,roles:e.roles,managerId:Number(e.managerId)}});i({isActive:!0,variant:"success",message:"\u66F4\u65B0\u6210\u529F"}),await r().readUsers(),l.push("/admin/users")}catch({response:s}){i({isActive:!0,variant:"error",message:"\u66F4\u65B0\u5931\u6557"})}finally{c(!1)}}),l=L(),E=()=>l.push("/admin/users");return(e,s)=>{const F=T,v=q,U=k,w=N;return z(),R(w,{size:"full",onConfirm:o(A),onCancel:E},{default:j(()=>[M("article",Q,[n(F,{name:"name",type:"text",class:"col-span-1",title:"\u59D3\u540D"}),n(F,{name:"email",class:"col-span-1",type:"email",title:"\u96FB\u5B50\u90F5\u4EF6",disabled:""}),n(v,{name:"department",options:o(O),class:"col-span-1",title:"\u90E8\u9580"},null,8,["options"]),n(v,{name:"managerId",options:o(b),class:"col-span-1",title:"\u4E3B\u7BA1"},null,8,["options"]),n(U,{name:"roles",class:"col-span-1",title:"\u89D2\u8272",tags:o(G).map(y=>y.text)},null,8,["tags"])])]),_:1},8,["onConfirm"])}}}),pe=$(W,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/AdminUsersEdit.vue"]]);export{pe as default};
