import{_ as w,a as y}from"./BaseFormSelect.b3cc2b7c.js";import{_ as N}from"./BaseFormTag.750d382e.js";import{_ as k}from"./BaseFormInput.bb1e2bec.js";import{_ as q,d as T,a as S,z as r,i as v,u as V,k as $,g as z,h as n,l as L,e as R,f as t}from"./index.fe3aa23c.js";import{u as o}from"./users.7cf8a190.js";import{d as j,r as M}from"./data.054ee288.js";import{u as O}from"./vee-validate.esm.aec001c6.js";import{c as G,a as m,d as H}from"./array.3b80710e.js";import"./BaseMessage.28d672dd.js";import"./BaseSelect.d356a1dc.js";import"./BaseTag.31cf6300.js";import"./BaseInput.978f8260.js";import"./api.a4fc115a.js";const J={class:"m-2 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4"},K=T({__name:"AdminUsersEdit",setup(P){var p,d,_,B,g;const h=S(),u=r(()=>h.params.id),a=r(()=>o().user(Number(u.value))),C=G({department:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),name:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B"),email:m().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").email("\u4E0D\u7B26\u5408\u96FB\u5B50\u90F5\u4EF6\u683C\u5F0F"),role:H().required("\u6B64\u6B04\u4F4D\u5FC5\u586B").min(1,"\u6700\u5C11\u9078\u64C7\u4E00\u9805")}),{handleSubmit:D}=O({initialValues:{department:((p=a.value)==null?void 0:p.department)||"",email:((d=a.value)==null?void 0:d.email)||"",name:((_=a.value)==null?void 0:_.name)||"",role:((B=a.value)==null?void 0:B.role)||[],managerId:(g=a.value)==null?void 0:g.manager.id},validationSchema:C}),E=r(()=>{var e;return(e=o().activeUsers)==null?void 0:e.filter(s=>s.role.includes(2)&&s.id!==Number(u.value)).map(s=>({text:s.name,value:s.id}))}),i=v("setToastData",()=>null),l=v("setIsLoading",()=>null),x=D(async e=>{try{l(!0);const s=await o().updateUser({id:Number(u.value),user:{name:e.name,department:e.department,role:e.role,managerId:e.managerId}});i({isActive:!0,variant:"success",message:"\u66F4\u65B0\u6210\u529F"}),await o().readUsers(),c.push("/admin/users")}catch({response:s}){i({isActive:!0,variant:"error",message:"\u66F4\u65B0\u5931\u6557"})}finally{l(!1)}}),c=V(),I=()=>c.push("/admin/users");return(e,s)=>{const F=k,f=y,U=N,b=w;return L(),$(b,{size:"full",onConfirm:n(x),onCancel:I},{default:z(()=>[R("article",J,[t(F,{name:"name",type:"text",class:"col-span-1",title:"\u59D3\u540D"}),t(F,{name:"email",class:"col-span-1",type:"email",title:"\u96FB\u5B50\u90F5\u4EF6",disabled:""}),t(f,{name:"department",options:n(j),class:"col-span-1",title:"\u90E8\u9580"},null,8,["options"]),t(f,{name:"managerId",options:n(E),class:"col-span-1",title:"\u4E3B\u7BA1"},null,8,["options"]),t(U,{name:"role",class:"col-span-1",title:"\u89D2\u8272",tags:n(M).map(A=>A.text)},null,8,["tags"])])]),_:1},8,["onConfirm"])}}}),me=q(K,[["__file","/home/runner/work/peer-assessment/peer-assessment/src/views/AdminUsersEdit.vue"]]);export{me as default};
